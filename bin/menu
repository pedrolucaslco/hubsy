#!/bin/bash
# Hubsy Menu ------------------------------------------------------------------

# Useful ascii icons: âœ± â”œ â”” â”€

# Check and Update version of Hubsy --------------------------------------------

# Show menu --------------------------------------------------------------------
while true; do
    scripts=($(find ~/scripts -maxdepth 1 -type f -executable))

    opcao=$(gum choose --header "Select an option with the arrow keys or type / to search by name" \
      "Terminal           â€” Exit Hubsy directly to Terminal" \
      "Scripts            â€” Run your custom scripts from ~/scripts" \
      "Install            â€” Install apt packages with easy search" \
      "Update             â€” Update & Upgrade your system" \
      "Setup              â€” Setup common linux files and .config files from applications" \
      "Refresh Terminal   â€” Run a simple source ./bashrc " \
      "   " \
      "â”€â”€ TUI Terminal Interfaces" \
      "   " \
      "Lazydocker         â€” A simple terminal UI for docker" \
      "Btop               â€” Resource Monitor on Terminal" \
      "   " \
      "â”€â”€ Third Party Tools from the Community" \
      "   " \
      "Linutil            â€” Chris Titus Tech's Linux Toolbox" \
      "   " \
      "â”€â”€ About" \
      "   " \
      "About This PC      â€” Show system information with Fastfetch" \
      "About Hubsy        â€” Hubsy about section" \
      "   " \
      "Quit               â€” Exit Hubsy and Quit the terminal" \
      "Set Screen Britghtness to Max" \
      "Set Screen Britghtness to Min" \
      "   ")

    #   "â”€â”€ Hubsy Debug" \
    #   "Set all bin files as executable" \
    #   "Hubsy Dev Enviropment" \

    case "$opcao" in
        # *"   "*) ;;  # ignora divisor 
        # *"â”€â”€"*) ;; # ignora divisor

        Terminal*)
            clear 
            gum spin --spinner dot --title "Opening a new terminal..." -- sleep 0.5
            echo ""
            echo "To return do Hubsy, type 'hubsy' and press Enter."
            echo ""
            return 0 2>/dev/null || break
            ;;

        Scripts*)
            if [ ${#scripts[@]} -eq 0 ]; then
                echo "No scripts found in ~/scripts"
                sleep 2
            else
                options=("Back to menu")
                options+=("Edit scripts...")
                options+=("${scripts[@]##*/}")

                scriptchoice=$(printf "%s\n" "${options[@]}" | gum choose)

                if [ "$scriptchoice" = "Back to menu" ]; then
                    continue
                elif [ "$scriptchoice" = "Edit scripts..." ]; then
                    gum spin --spinner dot --title "Opening scripts folder..." -- sleep 0.5
                    $EDITOR ~/scripts/.
                    continue
                else 
                    bash ~/scripts/"$scriptchoice"
                    gum confirm "Back to menu?" && continue
                fi
            fi
            ;;

        Install*)
            $HUBSY_PATH/bin/apt-install.sh
            gum confirm "Back to menu?" && continue
            ;;

        Update*)
            source $HUBSY_PATH/bin/system-update
            source $HUBSY_PATH/bin/hubsy-update

            gum confirm "System and Hubsy updated. Back to menu?" && continue
            ;;

        Setup*)
            $HUBSY_PATH/bin/setup.sh
            ;;
        
        *"Refresh Terminal"*)
            gum spin --spinner dot --title "Refreshing terminal..." -- sleep 0.5
            
            [ -f ~/.bashrc ] && source ~/.bashrc
            [ -f ~/.bash_aliases ] && source ~/.bash_aliases
            exec "$SHELL"
            ;;

        Lazydocker*)
            if ! command -v lazydocker &> /dev/null; then
                echo "Lazydocker is not installed. Please install it first."
                sleep 2
            else
                lazydocker
                gum confirm "Back to menu?" && continue
            fi
            ;;

        Btop*)
            if ! command -v btop &> /dev/null; then
                echo "Btop is not installed. Please install it first."
                sleep 2
            else
                btop
                gum confirm "Back to menu?" && continue
            fi
            ;;

        Linutil*)
            curl -fsSL https://christitus.com/linux | sh
            gum confirm "Back to menu?" && continue
            ;;

        *"About This PC"*)
            clear
            fastfetch
            gum confirm "Back to menu?" && continue
            ;;

        *"About Hubsy"*)
            clear
            source $HUBSY_PATH/bin/header
            echo " "
            cat $HUBSY_PATH/description
            echo " "
            echo "Visit my GitHub: https://github.com/pedrolucaslco"
            echo " "
            gum confirm "Back to menu?" && continue
            ;;

        Quit*)
            clear && exit
        ;;


        # DEBUG OPTIONS
        *"Hubsy Dev Enviropment"*)
            gum spin --spinner dot --title "Opening Hubsy Development Enviropment..." -- sleep 0.5
            code $HUBSY_PATH
            gum confirm "Back to menu?" && continue
            ;;

        *"Set Screen Britghtness to Max"*)
            sudo brightnessctl set 70% -q
            echo "ðŸ”† Brightness set to 70%"
            gum confirm "Back to menu?" && continue
            ;;

        *"Set Screen Britghtness to Min"*)
            sudo brightnessctl set 1% -q
            echo "ðŸŒ‘ Brightness set to 1%"
            gum confirm "Back to menu?" && continue
            ;;

        *"Set all bin files as executable"*)
            find "$HUBSY_PATH/bin" -type f -exec sudo chmod +x {} \;
            gum confirm "Back to menu?" && continue
            ;;
    esac
done
